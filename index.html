<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé™ COLLIDER - Impossible Music Generator</title>
    <style>
/* EMBEDDED CSS - Everything in one file for stability - NO EXTERNAL DEPENDENCIES */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --void: #0a0a0a;
    --concrete: #1a1a1a;
    --fog: #2a2a2a;
    --ghost: #888888;
    --paper: #f5f5f5;
    --electric-blue: #00d9ff;
    --hot-pink: #ff006e;
    --acid-yellow: #ffbe0b;
    --laser-green: #00ff9f;
    --deep-purple: #8338ec;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    background: var(--void);
    color: var(--paper);
    min-height: 100vh;
    padding-bottom: 2rem;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

h1 {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    font-size: clamp(1.8rem, 6vw, 4rem);
    font-weight: 800;
    text-align: center;
    margin-bottom: 0.5rem;
}

.glitch-text {
    animation: glitch 3s infinite;
}

@keyframes glitch {
    0%, 90%, 100% { transform: translate(0); }
    92% { transform: translate(-2px, 2px); color: var(--hot-pink); }
    94% { transform: translate(2px, -2px); color: var(--electric-blue); }
    96% { transform: translate(-2px, -2px); color: var(--laser-green); }
}

.text-center { text-align: center; }
.mb-1 { margin-bottom: 0.5rem; }
.mb-2 { margin-bottom: 1rem; }
.mt-2 { margin-top: 1rem; }

button {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    font-size: 1rem;
    font-weight: 600;
    padding: 1rem 2rem;
    border: 2px solid var(--electric-blue);
    background: var(--concrete);
    color: var(--paper);
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

button:hover {
    background: var(--electric-blue);
    color: var(--void);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 217, 255, 0.4);
}

button.primary {
    background: var(--electric-blue);
    color: var(--void);
    border-color: var(--electric-blue);
    font-size: 1.2rem;
    padding: 1.5rem 3rem;
}

button.primary:hover {
    background: var(--laser-green);
    border-color: var(--laser-green);
}

input[type="password"], input[type="text"], textarea {
    width: 100%;
    padding: 1rem;
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    background: var(--concrete);
    border: 2px solid var(--fog);
    color: var(--paper);
}

input:focus, textarea:focus {
    outline: none;
    border-color: var(--electric-blue);
}

textarea {
    min-height: 100px;
    resize: vertical;
}

.state {
    display: none;
}

.state.active {
    display: block;
}

.intent-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    margin: 1rem 0;
}

.intent {
    padding: 1rem;
    text-align: center;
    font-size: 0.9rem;
    min-height: 90px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

#toast-container {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
}

.toast {
    background: var(--concrete);
    border: 2px solid var(--electric-blue);
    color: var(--paper);
    padding: 1rem 2rem;
    margin-bottom: 0.5rem;
    animation: slideIn 0.3s ease;
    max-width: 90vw;
}

.toast.error {
    border-color: var(--hot-pink);
    background: rgba(255, 0, 110, 0.2);
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.progress-container {
    width: 100%;
    height: 4px;
    background: var(--concrete);
    margin: 2rem 0;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, 
        var(--hot-pink), 
        var(--acid-yellow), 
        var(--laser-green), 
        var(--electric-blue),
        var(--deep-purple)
    );
    width: 0%;
    animation: progress 20s linear;
}

@keyframes progress {
    to { width: 100%; }
}

pre {
    background: var(--concrete);
    padding: 1rem;
    overflow-x: auto;
    font-size: 0.85rem;
    border-left: 3px solid var(--electric-blue);
    white-space: pre-wrap;
}

@media (max-width: 768px) {
    .container { padding: 1rem; }
    h1 { font-size: 1.75rem; }
    .intent-grid { grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
    .intent { min-height: 80px; padding: 0.75rem; font-size: 0.85rem; }
}
    </style>
</head>
<body>
<div class="container">
    <!-- API GATE -->
    <div id="api-gate" class="state active">
        <div class="text-center mb-2">
            <h1 class="glitch-text">üé™ COLLIDER</h1>
            <p>impossible music generator</p>
        </div>
        <div class="mb-2">
            <p>You'll need a Claude API key (free to start, ~$0.05 per generation)</p>
        </div>
        <div class="mb-2">
            <input type="password" id="api-key-input" placeholder="sk-ant-api03-...">
        </div>
        <div class="mb-2">
            <label><input type="checkbox" id="remember-key" checked> Remember this (localStorage only)</label>
        </div>
        <div class="text-center">
            <button id="submit-api-key" class="primary">üé™ ENTER</button>
        </div>
        <div class="mt-2 text-center">
            <p><small>Your key stays in your browser. We never see it.</small></p>
            <p><small><a href="https://console.anthropic.com" target="_blank" style="color: var(--electric-blue);">Get API key ‚Üí</a></small></p>
        </div>
    </div>

    <!-- INTENT SELECTION -->
    <div id="intent-selection" class="state">
        <div class="text-center mb-2">
            <h1 class="glitch-text">COLLIDER</h1>
            <p>What do you want?</p>
        </div>
        <div class="intent-grid">
            <button class="intent" data-intent="laugh">üéâ<br>LAUGH</button>
            <button class="intent" data-intent="banger">üî•<br>BANGER</button>
            <button class="intent" data-intent="seduce">üíï<br>SEDUCE</button>
            <button class="intent" data-intent="scramble">üß†<br>SCRAMBLE</button>
            <button class="intent" data-intent="story">üé≠<br>STORY</button>
            <button class="intent" data-intent="hype">üèÉ<br>HYPE</button>
            <button class="intent" data-intent="chill">üòå<br>CHILL</button>
            <button class="intent" data-intent="cry">üò¢<br>CRY</button>
        </div>
        <div class="text-center">
            <button class="intent primary" data-intent="surprise" style="width: 100%; padding: 2rem;">üé™ SURPRISE ME</button>
        </div>
    </div>

    <!-- VIBE INPUT -->
    <div id="vibe-input" class="state">
        <button id="back-to-intents" style="margin-bottom: 1rem;">‚Üê back</button>
        <div class="text-center mb-2">
            <h2 id="intent-title"></h2>
        </div>
        <div class="mb-2">
            <p>Optional: Add context to guide it</p>
            <p><small>(or leave blank for pure random)</small></p>
        </div>
        <textarea id="vibe-textarea" placeholder="e.g., falling in love during a bank heist"></textarea>
        <div class="text-center mt-2">
            <button id="generate-btn" class="primary">GENERATE</button>
        </div>
    </div>

    <!-- GENERATING -->
    <div id="generating" class="state">
        <div class="text-center mb-2">
            <h2>üé® Generating...</h2>
        </div>
        <div class="progress-container">
            <div class="progress-bar"></div>
        </div>
        <p id="generation-status" class="text-center">Analyzing vibe...</p>
    </div>

    <!-- RESULT -->
    <div id="result" class="state">
        <div class="text-center mb-2">
            <h2>‚ú® YOUR COLLISION ‚ú®</h2>
        </div>
        <div class="mb-2">
            <button id="copy-both" class="primary" style="width: 100%;">üìã COPY TO SUNO</button>
        </div>
        <div id="result-content"></div>
        <div class="text-center mt-2">
            <button id="make-another" class="primary">üé™ MAKE ANOTHER</button>
        </div>
    </div>
</div>

<div id="toast-container"></div>

<script>
// EMBEDDED DATA - 20 curated genres for stability
const MUSIC_GENRES = [
    { name: "UK Drill", bpm: [138, 142], category: "electronic", keywords: ["dark", "sliding 808s", "menacing"] },
    { name: "Hyperpop", bpm: [140, 180], category: "electronic", keywords: ["maximalist", "pitched vocals", "glitchy"] },
    { name: "Techno (Detroit)", bpm: [120, 135], category: "electronic", keywords: ["4/4 kick", "repetitive", "minimal"] },
    { name: "Vaporwave", bpm: [60, 100], category: "electronic", keywords: ["nostalgic", "slowed", "aesthetic"] },
    { name: "Gregorian Chant", bpm: [40, 60], category: "ceremonial", keywords: ["Latin", "monastic", "sacred"] },
    { name: "Qawwali", bpm: [80, 160], category: "ceremonial", keywords: ["Sufi", "devotional", "ecstatic"] },
    { name: "Tuvan Throat Singing", bpm: [0, 80], category: "world", keywords: ["overtone", "shamanic", "khoomei"] },
    { name: "Fado", bpm: [70, 90], category: "folk", keywords: ["Portuguese", "saudade", "melancholic"] },
    { name: "Bluegrass", bpm: [120, 180], category: "folk", keywords: ["banjo", "fast picking", "mountain"] },
    { name: "Flamenco", bpm: [80, 200], category: "folk", keywords: ["palmas", "duende", "passionate"] },
    { name: "Bossa Nova", bpm: [80, 120], category: "latin", keywords: ["gentle", "nylon string", "sway"] },
    { name: "Baile Funk", bpm: [128, 135], category: "latin", keywords: ["favela", "tamborz√£o", "party"] },
    { name: "Trap", bpm: [130, 150], category: "hiphop", keywords: ["808 bass", "hi-hat rolls", "Southern"] },
    { name: "Boom Bap", bpm: [85, 95], category: "hiphop", keywords: ["breaks", "jazz samples", "golden age"] },
    { name: "Free Jazz", bpm: [0, 300], category: "jazz", keywords: ["atonal", "improvised", "Ornette"] },
    { name: "Doom Metal", bpm: [40, 80], category: "metal", keywords: ["slow", "heavy", "crushing"] },
    { name: "Ambient", bpm: [0, 60], category: "ambient", keywords: ["spacious", "slow evolution", "Eno"] },
    { name: "Hardcore Punk", bpm: [160, 220], category: "punk", keywords: ["fast", "aggressive", "DIY"] },
    { name: "Dub", bpm: [60, 90], category: "reggae", keywords: ["echo", "reverb", "King Tubby"] },
    { name: "Gamelan", bpm: [60, 180], category: "world", keywords: ["bronze", "interlocking", "cyclical"] }
];

const LITERARY_STYLES = [
    { name: "Stream of Consciousness", keywords: ["flowing", "internal", "Woolfian"] },
    { name: "Cut-Up Technique", keywords: ["fragmented", "Burroughs", "chaotic"] },
    { name: "Shakespearean Sonnet", keywords: ["14 lines", "iambic", "volta"] },
    { name: "Lovecraftian Horror", keywords: ["cosmic", "dread", "unknowable"] },
    { name: "Body Horror", keywords: ["visceral", "transformation", "flesh"] },
    { name: "Internet Creepypasta", keywords: ["digital", "sudden", "uncanny"] },
    { name: "Screwball Comedy", keywords: ["rapid", "witty", "absurd"] },
    { name: "Noir Fiction", keywords: ["cynical", "dark", "hardboiled"] },
    { name: "Confessional Poetry", keywords: ["intimate", "personal", "raw"] },
    { name: "Three-Act Structure", keywords: ["setup", "confrontation", "resolution"] },
    { name: "Absurdist Fiction", keywords: ["meaningless", "existential", "Kafka"] },
    { name: "Romantic Poetry", keywords: ["emotional", "nature", "sublime"] },
    { name: "Minimalist Prose", keywords: ["sparse", "Hemingway", "simple"] },
    { name: "Baroque Prose", keywords: ["ornate", "elaborate", "dense"] },
    { name: "Haiku", keywords: ["5-7-5", "nature", "present moment"] },
    { name: "Beat Poetry", keywords: ["spontaneous", "jazz-influenced", "Ginsberg"] },
    { name: "Magical Realism", keywords: ["matter-of-fact", "fantastic", "Garc√≠a M√°rquez"] },
    { name: "Epistolary", keywords: ["letters", "correspondence", "intimate"] },
    { name: "Hard Science Fiction", keywords: ["scientific accuracy", "technical", "Clarke"] },
    { name: "Surrealist Prose", keywords: ["dreamlike", "irrational", "Breton"] }
];

const INTENT_CONFIGS = {
    laugh: {
        name: "Make Me Laugh",
        emoji: "üéâ",
        constraints: { bpm_range: [80, 180] }
    },
    banger: {
        name: "Make A Banger",
        emoji: "üî•",
        constraints: { bpm_range: [120, 180] }
    },
    seduce: {
        name: "Seduce Someone",
        emoji: "üíï",
        constraints: { bpm_max: 120 }
    },
    scramble: {
        name: "Scramble My Brain",
        emoji: "üß†",
        constraints: {}
    },
    story: {
        name: "Tell A Story",
        emoji: "üé≠",
        constraints: { bpm_range: [60, 140] }
    },
    hype: {
        name: "Hype Me Up",
        emoji: "üèÉ",
        constraints: { bpm_range: [140, 200] }
    },
    chill: {
        name: "Chill Me Out",
        emoji: "üòå",
        constraints: { bpm_max: 100 }
    },
    cry: {
        name: "Make Me Cry",
        emoji: "üò¢",
        constraints: { bpm_max: 100 }
    },
    surprise: {
        name: "Surprise Me",
        emoji: "üé™",
        constraints: {}
    }
};

let APP_STATE = {
    apiKey: null,
    intent: null,
    vibe: null,
    result: null
};

function setState(stateName) {
    document.querySelectorAll('.state').forEach(s => s.classList.remove('active'));
    document.getElementById(stateName).classList.add('active');
}

function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

function initApp() {
    const savedKey = localStorage.getItem('claude_api_key');
    if (savedKey) {
        document.getElementById('api-key-input').value = savedKey;
    }
}

function selectGenres(intent) {
    const config = INTENT_CONFIGS[intent];
    let eligible = MUSIC_GENRES.filter(g => {
        if (config.constraints.bpm_range) {
            const [min, max] = config.constraints.bpm_range;
            if (g.bpm[1] < min || g.bpm[0] > max) return false;
        }
        if (config.constraints.bpm_max) {
            if (g.bpm[0] > config.constraints.bpm_max) return false;
        }
        return true;
    });
    
    const selected = [];
    const usedCategories = new Set();
    
    while (selected.length < 3 && eligible.length > 0) {
        const randomIndex = Math.floor(Math.random() * eligible.length);
        const genre = eligible[randomIndex];
        
        if (!usedCategories.has(genre.category)) {
            selected.push(genre);
            usedCategories.add(genre.category);
        }
        
        eligible.splice(randomIndex, 1);
    }
    
    return selected;
}

function selectStyles(count = 2) {
    const shuffled = [...LITERARY_STYLES].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
}

async function callClaude(prompt, maxTokens = 1000) {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
            'x-api-key': APP_STATE.apiKey,
            'anthropic-version': '2023-06-01',
            'content-type': 'application/json'
        },
        body: JSON.stringify({
            model: 'claude-sonnet-4-20250514',
            max_tokens: maxTokens,
            messages: [{ role: 'user', content: prompt }]
        })
    });
    
    if (!response.ok) {
        throw new Error(`API call failed: ${response.status}`);
    }
    
    const data = await response.json();
    return data.content[0].text;
}

async function generateCollision(intent, vibe) {
    const genres = selectGenres(intent);
    const styles = selectStyles(2);
    
    document.getElementById('generation-status').textContent = 'Selecting impossible genres...';
    
    const genreNames = genres.map(g => g.name).join(', ');
    const styleNames = styles.map(s => s.name).join(', ');
    
    document.getElementById('generation-status').textContent = 'Analyzing contradictions...';
    
    const structurePrompt = `You are generating a Suno AI music prompt.

GENRES TO COLLIDE: ${genreNames}
LITERARY STYLES: ${styleNames}
${vibe ? `VIBE: ${vibe}` : ''}
INTENT: ${INTENT_CONFIGS[intent].name}

Choose ONE structure from: ORBITAL, ENTANGLED, FRACTAL, COLLAPSE, MYTHIC, DRIFT

Respond with ONLY the structure name (one word).`;

    document.getElementById('generation-status').textContent = 'Choosing structure...';
    const structure = (await callClaude(structurePrompt, 50)).trim();
    
    document.getElementById('generation-status').textContent = 'Writing lyrics...';
    
    const lyricsPrompt = `Generate Suno AI lyrics for impossible music.

GENRES: ${genreNames}
STYLES: ${styleNames}
STRUCTURE: ${structure}
${vibe ? `VIBE: ${vibe}` : ''}
INTENT: ${INTENT_CONFIGS[intent].name}

Write 8-16 lines of lyrics that embody this collision. Be creative and strange. Output ONLY the lyrics, no explanations.`;

    const lyrics = await callClaude(lyricsPrompt, 500);
    
    return {
        genres,
        styles,
        structure,
        lyrics,
        musicStyle: genreNames + ', ' + styleNames.join(', ')
    };
}

function displayResult(result) {
    const html = `
        <h3>üéµ Music Style Prompt</h3>
        <pre>${result.musicStyle}</pre>
        
        <h3>üìñ Lyrics</h3>
        <pre>${result.lyrics}</pre>
        
        <p><small><strong>Structure:</strong> ${result.structure}</small></p>
        <p><small><strong>Genres:</strong> ${result.genres.map(g => g.name).join(' √ó ')}</small></p>
        <p><small><strong>Styles:</strong> ${result.styles.map(s => s.name).join(' √ó ')}</small></p>
    `;
    document.getElementById('result-content').innerHTML = html;
}

function copyToClipboard() {
    const result = APP_STATE.result;
    const formatted = `Music Style:\n${result.musicStyle}\n\nLyrics:\n${result.lyrics}`;
    navigator.clipboard.writeText(formatted);
    showToast('‚úì Copied! Paste into Suno');
}

// EVENT LISTENERS
document.addEventListener('DOMContentLoaded', () => {
    initApp();
    
    document.getElementById('submit-api-key').addEventListener('click', () => {
        const key = document.getElementById('api-key-input').value.trim();
        
        if (!key.startsWith('sk-ant-api03-') || key.length < 50) {
            showToast('Invalid API key format', 'error');
            return;
        }
        
        if (document.getElementById('remember-key').checked) {
            localStorage.setItem('claude_api_key', key);
        }
        
        APP_STATE.apiKey = key;
        showToast('‚ú® Ready to generate!');
        setState('intent-selection');
    });
    
    document.querySelectorAll('.intent').forEach(btn => {
        btn.addEventListener('click', (e) => {
            APP_STATE.intent = e.currentTarget.dataset.intent;
            document.getElementById('intent-title').textContent = 
                INTENT_CONFIGS[APP_STATE.intent].emoji + ' ' + 
                INTENT_CONFIGS[APP_STATE.intent].name;
            setState('vibe-input');
        });
    });
    
    document.getElementById('back-to-intents').addEventListener('click', () => {
        setState('intent-selection');
    });
    
    document.getElementById('generate-btn').addEventListener('click', async () => {
        APP_STATE.vibe = document.getElementById('vibe-textarea').value;
        setState('generating');
        
        try {
            const result = await generateCollision(APP_STATE.intent, APP_STATE.vibe);
            APP_STATE.result = result;
            displayResult(result);
            setState('result');
        } catch (err) {
            showToast('Generation failed: ' + err.message, 'error');
            setState('vibe-input');
        }
    });
    
    document.getElementById('copy-both').addEventListener('click', copyToClipboard);
    
    document.getElementById('make-another').addEventListener('click', () => {
        document.getElementById('vibe-textarea').value = '';
        setState('vibe-input');
    });
});
</script>
</body>
</html>
